; make-symbolic-link core semantics.

(condition-case err
    (make-symbolic-link 1 "x")
  (error err))

(condition-case err
    (make-symbolic-link "x" 1)
  (error err))

(condition-case err
    (make-symbolic-link "x" "y" nil nil)
  (error err))

(let* ((d (make-temp-file "neovm-symlink-" t))
       (target (expand-file-name "target.txt" d))
       (link (expand-file-name "link.txt" d)))
  (with-temp-buffer
    (insert "x")
    (write-region nil nil target))
  (prog1
      (list (make-symbolic-link target link)
            (not (null (file-symlink-p link))))
    (delete-file link)
    (delete-file target)
    (delete-directory d)))

(let* ((d (make-temp-file "neovm-symlink-exists-" t))
       (target (expand-file-name "target.txt" d))
       (link (expand-file-name "link.txt" d)))
  (with-temp-buffer
    (insert "x")
    (write-region nil nil target))
  (make-symbolic-link target link)
  (prog1
      (condition-case err
          (make-symbolic-link target link)
        (error (car err)))
    (delete-file link)
    (delete-file target)
    (delete-directory d)))

(let* ((d (make-temp-file "neovm-symlink-okif-" t))
       (target (expand-file-name "target.txt" d))
       (link (expand-file-name "link.txt" d)))
  (with-temp-buffer
    (insert "x")
    (write-region nil nil target))
  (make-symbolic-link target link)
  (prog1
      (list (make-symbolic-link target link t)
            (not (null (file-symlink-p link))))
    (delete-file link)
    (delete-file target)
    (delete-directory d)))

(let ((d (make-temp-file "neovm-symlink-eval-" t)))
  (let ((default-directory (file-name-as-directory d)))
    (with-temp-buffer
      (insert "x")
      (write-region nil nil "target.txt"))
    (prog1
        (list (make-symbolic-link "target.txt" "link.txt")
              (not (null (file-symlink-p "link.txt"))))
      (delete-file "link.txt")
      (delete-file "target.txt")))
  (delete-directory d))

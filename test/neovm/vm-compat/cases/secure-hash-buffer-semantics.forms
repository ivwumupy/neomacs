; secure-hash buffer object behavior should match GNU Emacs.
(with-temp-buffer
  (insert "abc")
  (secure-hash 'sha1 (current-buffer)))
(with-temp-buffer
  (insert "abc")
  (secure-hash 'sha1 (current-buffer) 1 4))
(with-temp-buffer
  (insert "abc")
  (condition-case err
      (secure-hash 'sha1 (current-buffer) 0 3)
    (error err)))
(with-temp-buffer
  (insert "abc")
  (condition-case err
      (secure-hash 'sha1 (current-buffer) t 3)
    (error err)))
(with-temp-buffer
  (insert "abc")
  (let ((m (copy-marker 2)))
    (secure-hash 'sha1 (current-buffer) m 4)))
(let ((b (generate-new-buffer " *secure-dead*")))
  (kill-buffer b)
  (condition-case err
      (secure-hash 'sha1 b)
    (error err)))

; directory-files-and-attributes semantics: names, ordering/count, id-format and count typing.
(setq vm-dfa-dir
      (let* ((forms-file (getenv "NEOVM_FORMS_FILE"))
             (base (if forms-file (file-name-directory forms-file) default-directory)))
        (expand-file-name "directory-files-fixtures" base)))
(mapcar #'car (directory-files-and-attributes vm-dfa-dir))
(mapcar #'car (directory-files-and-attributes vm-dfa-dir t))
(mapcar #'car (directory-files-and-attributes vm-dfa-dir nil "\\.el$"))
(sort (copy-sequence (mapcar #'car (directory-files-and-attributes vm-dfa-dir nil nil t))) #'string<)
(mapcar #'car (directory-files-and-attributes vm-dfa-dir nil nil t nil 2))
(mapcar #'car (directory-files-and-attributes vm-dfa-dir nil nil nil nil 2))
(let* ((xs (directory-files-and-attributes vm-dfa-dir nil nil nil t 1))
       (x (car xs))
       (attrs (cdr x)))
  (list (car x) (stringp (nth 2 attrs)) (stringp (nth 3 attrs))))
(condition-case err (directory-files-and-attributes vm-dfa-dir nil nil nil nil -1)
  (list (car err) (nth 1 err)))
(condition-case err (directory-files-and-attributes vm-dfa-dir nil nil nil nil "x")
  (list (car err) (nth 1 err)))
(condition-case err (directory-files-and-attributes vm-dfa-dir nil "[invalid")
  (error (car err)))
(condition-case err (directory-files-and-attributes "/nonexistent/neovm-vm-compat-missing-dir")
  (error (car err)))
(condition-case err (directory-files-and-attributes vm-dfa-dir nil nil nil nil 0 nil)
  (car err))
(let* ((default-directory (file-name-directory vm-dfa-dir)))
  (equal (sort (copy-sequence (mapcar #'car (directory-files-and-attributes "directory-files-fixtures" nil "^[^.]"))) #'string<)
         (sort (copy-sequence (mapcar #'car (directory-files-and-attributes vm-dfa-dir nil "^[^.]"))) #'string<)))
